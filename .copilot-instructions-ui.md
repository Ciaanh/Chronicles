# Chronicles Addon - UI and User Experience Context

## User Interface Development Guidelines

### UI Architecture Overview

Chronicles uses a modern, tab-based interface system built on WoW's native UI framework with custom templates and components for consistency and maintainability.

#### Core UI Components

- **MainFrameUI**: Primary timeline interface container
- **Timeline View**: Scrollable event timeline with expansion filtering
- **Event Details**: Expandable event information panels
- **Character Details**: Expandable character information panels
- **Faction Details**: Expandable faction information panels
- **Settings Panel**: Configuration interface
- **Templates**: Reusable UI components for consistency

### UI Design Principles

#### Consistency with WoW UI

1. **Native Look and Feel**: Use Blizzard's UI conventions and styling
2. **Simplicity**: Avoid complex UI components for maintanability and readability

#### User Experience Focus

1. **Intuitive Navigation**: Clear visual hierarchy and navigation paths
2. **Performance**: Smooth scrolling and responsive interactions
3. **Information Density**: Balance detail with readability
4. **Contextual Actions**: Relevant options based on current content

### Frame Management Patterns

#### Main Frame Structure (XML-Based)

Chronicles uses modern XML-based UI architecture with mixins:

```xml
<!-- MainFrameUI.xml - Primary interface container (1200x850) -->
<Frame name="MainFrameUI" mixin="MainFrameUIMixin" parent="UIParent" toplevel="true" enableMouse="true" hidden="true">
    <Size x="1200" y="850"/>
    <Anchors>
        <Anchor point="CENTER" />
    </Anchors>
    <Frames>
        <Button name="CloseButton" inherits="UIPanelCloseButton">
            <Anchors>
                <Anchor point="CENTER" x="600" y="425"/>
            </Anchors>
        </Button>

        <Frame parentKey="TabUI" inherits="TabUITemplate" frameLevel="100">
            <Anchors>
                <Anchor point="TOP" relativePoint="CENTER" x="0" y="425"/>
            </Anchors>
        </Frame>
    </Frames>
    <Scripts>
        <OnLoad method="OnLoad"/>
        <OnShow method="OnShow"/>
        <OnHide method="OnHide"/>
    </Scripts>
</Frame>
```

#### Tab System Architecture

```xml
<!-- Tab-based navigation with Events, Characters, Factions, Settings -->
<Frame name="TabUITemplate" inherits="TabSystemOwnerTemplate" mixin="TabUIMixin" virtual="true">
    <Size x="1200" y="850"/>
    <Frames>
        <Frame parentKey="TabSystem" inherits="TabSystemTemplate">
            <KeyValues>
                <KeyValue key="minTabWidth" value="100" type="number"/>
                <KeyValue key="maxTabWidth" value="150" type="number"/>
                <KeyValue key="tabSelectSound" value="SOUNDKIT.UI_CLASS_TALENT_TAB" type="global"/>
            </KeyValues>
        </Frame>

        <Frame parentKey="Events" frameLevel="100" hidden="true">
            <Frames>
                <Frame parentKey="Book" inherits="EventBookTemplate"/>
                <Frame parentKey="Timeline" inherits="TimelineTemplate"/>
                <Frame parentKey="EventList" inherits="EventListTemplate"/>
            </Frames>
        </Frame>

        <Frame parentKey="Characters" frameLevel="100" hidden="true">
            <Frames>
                <Frame parentKey="Book" inherits="CharacterBookTemplate"/>
                <Frame parentKey="CharacterList" inherits="CharacterListTemplate"/>
            </Frames>
        </Frame>

        <Frame parentKey="Factions" frameLevel="100" hidden="true">
            <Frames>
                <Frame parentKey="Book" inherits="FactionBookTemplate"/>
                <Frame parentKey="FactionList" inherits="FactionListTemplate"/>
            </Frames>
        </Frame>

        <Frame parentKey="Settings" frameLevel="100" inherits="SettingsTemplate" hidden="true"/>
    </Frames>
</Frame>
```

#### Mixin Pattern Implementation

```lua
-- MainFrameUIMixin - Primary interface logic
MainFrameUIMixin = {}

function MainFrameUIMixin:OnLoad()
    -- Initialize main frame
end

function MainFrameUIMixin:OnShow()
    self.TabUI:UpdateTabs()
    -- Update state management
    if private.Core.StateManager then
        private.Core.StateManager.setState("ui.isMainFrameOpen", true, "Main frame opened")
    end
    PlaySound(SOUNDKIT.UI_CLASS_TALENT_OPEN_WINDOW)
end

function MainFrameUIMixin:OnHide()
    PlaySound(SOUNDKIT.UI_CLASS_TALENT_CLOSE_WINDOW)
    if private.Core.StateManager then
        private.Core.StateManager.setState("ui.isMainFrameOpen", false, "Main frame closed")
    end
end

-- TabUIMixin - Tab system management
TabUIMixin = {}

TabUIMixin.FrameTabs = {
    Events = 1,
    Characters = 2,
    Factions = 3,
    Settings = 4
}

function TabUIMixin:OnLoad()
    TabSystemOwnerMixin.OnLoad(self)
    self:SetTabSystem(self.TabSystem)

    -- Register tabs
    self.EventsTabID = self:AddNamedTab("Events", self.Events)
    self.CharactersTabID = self:AddNamedTab("Characters", self.Characters)
    self.FactionsTabID = self:AddNamedTab("Factions", self.Factions)
    self.SettingsTabID = self:AddNamedTab("Settings", self.Settings)
end

function TabUIMixin:SetTab(tabID)
    TabSystemOwnerMixin.SetTab(self, tabID)
    -- Trigger event system
    private.Core.triggerEvent(
        private.constants.events.TabUITabSet,
        {frame = self, tabID = tabID},
        "MainFrameUI:SetTab"
    )
    return true
end
```

### Content Display System

#### Book-Style Interface Design

Chronicles uses a book-based layout for displaying event, character, and faction content:

```xml
<!-- Book template structure for content display -->
<Frame name="EventBookTemplate" virtual="true">
    <Frames>
        <!-- Chapter-based content with page navigation -->
        <Frame parentKey="Pages" inherits="BookPagesTemplate"/>
        <Frame parentKey="Navigation" inherits="BookNavigationTemplate"/>
    </Frames>
</Frame>

<Frame name="CharacterBookTemplate" virtual="true">
    <Frames>
        <Frame parentKey="Pages" inherits="BookPagesTemplate"/>
        <Frame parentKey="Navigation" inherits="BookNavigationTemplate"/>
    </Frames>
</Frame>

<Frame name="FactionBookTemplate" virtual="true">
    <Frames>
        <Frame parentKey="Pages" inherits="BookPagesTemplate"/>
        <Frame parentKey="Navigation" inherits="BookNavigationTemplate"/>
    </Frames>
</Frame>
```

#### Chapter and Page Templates

```xml
<!-- BookPages.xml - Content organization templates -->
<Frame name="ChapterHeaderTemplate" mixin="ChapterHeaderMixin" virtual="true">
    <Size x="$parent.viewWidth" y="50"/>
    <Layers>
        <Layer level="ARTWORK">
            <FontString parentKey="Text" inherits="SystemFont_Huge2" justifyH="LEFT">
                <Color color="SPELLBOOK_FONT_COLOR" />
            </FontString>
        </Layer>
    </Layers>
</Frame>

<Frame name="AuthorTemplate" mixin="AuthorMixin" virtual="true">
    <Size x="$parent.viewWidth" y="25"/>
    <Layers>
        <Layer level="ARTWORK">
            <FontString parentKey="Text" inherits="ChroniclesFontFamily_Text_Medium" justifyH="RIGHT">
                <Color color="SPELLBOOK_FONT_COLOR" />
            </FontString>
        </Layer>
    </Layers>
</Frame>
```

#### Data-Driven Content Display

```lua
-- Content rendering based on database structure
local function DisplayEventContent(eventData)
    -- eventData.chapters = { {header = "Chapter 1", pages = {"PAGE_001", "PAGE_002"}} }
    for _, chapter in ipairs(eventData.chapters) do
        local chapterFrame = CreateFrame("Frame", nil, bookFrame, "ChapterHeaderTemplate")
        chapterFrame.Text:SetText(Chronicles.L[chapter.header])

        for _, pageKey in ipairs(chapter.pages) do
            local pageFrame = CreateFrame("Frame", nil, bookFrame, "PageTemplate")
            pageFrame.Text:SetText(Chronicles.L[pageKey])
        end
    end
end

-- State management integration
local function UpdateContentDisplay(contentType, contentId)
    private.Core.StateManager.setState(
        "ui.currentContent",
        {type = contentType, id = contentId},
        "Content display updated"
    )
end
```

### Modern UI Integration and State Management

#### State Management Integration

Chronicles integrates with a centralized state management system:

```lua
-- UI state updates through StateManager
function UpdateUIState(key, value, context)
    if private.Core.StateManager then
        private.Core.StateManager.setState(key, value, context)
    end
end

-- Example state management calls
UpdateUIState("ui.currentTab", "Events", "Tab switched to Events")
UpdateUIState("ui.selectedEvent", eventId, "Event selected")
UpdateUIState("ui.filterSettings", filterData, "Filters updated")
```

#### Event-Driven Architecture

UI components communicate through the event system:

```lua
-- Event registration and handling
private.Core.triggerEvent(
    private.constants.events.TabUITabSet,
    {frame = self, tabID = tabID},
    "MainFrameUI:SetTab"
)

-- Event listeners for UI updates
function TabUIMixin:OnEventReceived(eventName, eventData)
    if eventName == "CONTENT_UPDATED" then
        self:RefreshCurrentTab()
    elseif eventName == "FILTER_CHANGED" then
        self:ApplyFilters(eventData.filters)
    end
end
```

### Timeline and Filtering Integration

Chronicles does not use expansion-based tabs as filtering. Instead, it uses:

1. **Content Type Tabs**: Events, Characters, Factions, Settings
2. **Timeline Navigation**: Integrated timeline component within Events tab
3. **Internal Filtering**: Timeline periods and event types handled within the content displays
4. **Book-Style Navigation**: Chapter/page navigation within individual content items

#### Timeline Integration

```lua
-- Timeline component within Events tab
local function InitializeTimeline(eventsFrame)
    local timeline = eventsFrame.Timeline
    timeline:SetTimelineData(Chronicles.Data:GetTimelineData())
    timeline:RegisterCallback("TIMELINE_SELECTION_CHANGED", function(selectedPeriod)
        eventsFrame.EventList:FilterByPeriod(selectedPeriod)
    end)
end
```

### Settings Integration

#### Settings Tab Implementation

```xml
<!-- Settings integrated as fourth tab -->
<Frame parentKey="Settings" frameLevel="100" inherits="SettingsTemplate" hidden="true">
    <Anchors>
        <Anchor point="TOP"/>
    </Anchors>
</Frame>
```

#### Configuration Management

Settings are managed through the integrated Settings tab rather than separate panels:

```lua
-- Settings handled within the main UI framework
function SettingsMixin:UpdateSetting(settingKey, value)
    Chronicles.Settings:SetValue(settingKey, value)
    -- Trigger UI refresh if needed
    private.Core.triggerEvent("SETTING_CHANGED", {key = settingKey, value = value})
end
```

### Timeline and Content Navigation

#### Timeline Event Display

Chronicles uses a timeline-based approach within the Events tab for navigating historical content:

```lua
-- Timeline navigation within Events tab
function EventsTabMixin:UpdateTimeline(expansionFilter)
    -- Get events for timeline display
    local events = Chronicles.Database:GetEventsByExpansion(expansionFilter)

    -- Clear existing timeline entries
    self.timelineFrame:ClearEntries()

    -- Populate timeline with events
    for _, event in ipairs(events) do
        local timelineEntry = self.timelineFrame:CreateEntry(event)
        timelineEntry:SetEventData(event)
        timelineEntry:SetOnClickHandler(function()
            self:DisplayEventDetails(event.id)
        end)
    end
end

-- Event detail display using book-style layout
function EventsTabMixin:DisplayEventDetails(eventId)
    local eventData = Chronicles.Database:GetEvent(eventId)
    if not eventData then return end

    -- Update state management
    private.Core.StateManager.setState("ui.selectedEvent", eventId, "Event selected from timeline")

    -- Display content using book templates
    self.contentFrame:DisplayContent(eventData)
end
end
```

## Summary

This UI framework ensures Chronicles provides an intuitive, accessible, and performant interface that integrates seamlessly with World of Warcraft's native UI while providing rich functionality for exploring historical events, characters, and factions through a modern tab-based system with book-style content display.
